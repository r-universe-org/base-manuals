<!DOCTYPE html>
<html>
  <head>
    <title>Package 'compiler' reference manual</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

    <!-- styling for math and syntax -->
    <link rel="stylesheet" type="text/css" href="https://r-universe.dev/static/katex.min.css">
    <link rel="stylesheet" type="text/css" href="https://r-universe.dev/static/R.css">
    <link rel="stylesheet" type="text/css" href="https://r-universe.dev/static/prism.css">

    <!-- for (future) customizations -->
    <script src="https://r-universe.dev/static/manual.js"></script>
    <link rel="stylesheet" type="text/css" href="https://r-universe.dev/static/manual.css?nocache=1">

  </head>

  <body class="macintosh">
    <h1 class="manual-title">Package 'compiler'</h1>
    <table class="description-table">
      <tr>
<th>Title:</th>
<td class="description-title">The R Compiler Package</td>
</tr>
      <tr>
<th>Description:</th>
<td class="description-description">Byte code compiler for R.</td>
</tr>
      <tr>
<th>Authors:</th>
<td class="description-author"><span>Luke Tierney &lt;luke-tierney@uiowa.edu&gt;</span></td>
</tr>
      <tr>
<th>Maintainer:</th>
<td class="description-maintainer">R Core Team &lt;do-use-Contact-address@r-project.org&gt;</td>
</tr>
      <tr>
<th>License:</th>
<td class="description-license">Part of R 4.3.2</td>
</tr>
      <tr>
<th>Version:</th>
<td class="description-version">4.3.2</td>
</tr>
      <tr>
<th>Built:</th>
<td class="description-date">2023-11-01 20:50:58 UTC</td>
</tr>
      <tr>
<th>Source:</th>
<td class="description-source">base</td>
</tr>
    </table>

    <a href="#help-index" style="color:black;"><h2 id="help-index">Help Index</h2></a>
    <ul id="help-index-list"><li class="help-index-item"><a href="#compile">Byte Code Compiler</a></li></ul>

    <hr>
    <div class="manual-pages-content"><div class="container manual-page" id="compile">

<a href="#compile" class="help-page-title"><h2 id="compile">Byte Code Compiler</h2></a>

<h3>Description</h3>

<p>These functions provide an interface to a byte code compiler for <span class="rlang"><b>R</b></span>.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">cmpfun<span class="token punctuation">(</span>f<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">)</span>
compile<span class="token punctuation">(</span>e<span class="token punctuation">,</span> env <span class="token operator">=</span> .GlobalEnv<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span> srcref <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">)</span>
cmpfile<span class="token punctuation">(</span>infile<span class="token punctuation">,</span> outfile<span class="token punctuation">,</span> ascii <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> env <span class="token operator">=</span> .GlobalEnv<span class="token punctuation">,</span>
        verbose <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span> version <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">)</span>
loadcmp<span class="token punctuation">(</span>file<span class="token punctuation">,</span> envir <span class="token operator">=</span> .GlobalEnv<span class="token punctuation">,</span> chdir <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span>
disassemble<span class="token punctuation">(</span>code<span class="token punctuation">)</span>
enableJIT<span class="token punctuation">(</span>level<span class="token punctuation">)</span>
compilePKGS<span class="token punctuation">(</span>enable<span class="token punctuation">)</span>
getCompilerOption<span class="token punctuation">(</span>name<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
setCompilerOptions<span class="token punctuation">(</span><span class="token ellipsis">...</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr>
<td><code id="compile_:_f">f</code></td>
<td>
<p>a closure.</p>
</td>
</tr>
<tr>
<td><code id="compile_:_options">options</code></td>
<td>
<p>list of named compiler options: see ‘Details’.</p>
</td>
</tr>
<tr>
<td><code id="compile_:_env">env</code></td>
<td>
<p>the top level environment for the compiling.</p>
</td>
</tr>
<tr>
<td><code id="compile_:_srcref">srcref</code></td>
<td>
<p>initial source reference for the expression.</p>
</td>
</tr>
<tr>
<td>
<code id="compile_:_file">file</code>, <code id="compile_:_infile">infile</code>, <code id="compile_:_outfile">outfile</code>
</td>
<td>
<p>pathnames; outfile defaults to infile with
a ‘<span class="file">.Rc</span>’ extension in place of any existing extension.</p>
</td>
</tr>
<tr>
<td><code id="compile_:_ascii">ascii</code></td>
<td>
<p>logical; should the compiled file be saved in ascii format?</p>
</td>
</tr>
<tr>
<td><code id="compile_:_verbose">verbose</code></td>
<td>
<p>logical; should the compiler show what is being compiled?</p>
</td>
</tr>
<tr>
<td><code id="compile_:_version">version</code></td>
<td>
<p>the workspace format version to use.  <code>NULL</code>
specifies the current default format (3).  Version 1 was the default
from <span class="rlang"><b>R</b></span> 0.99.0 to <span class="rlang"><b>R</b></span> 1.3.1 and version 2 from <span class="rlang"><b>R</b></span> 1.4.0 to 3.5.0.
Version 3 is supported from <span class="rlang"><b>R</b></span> 3.5.0.</p>
</td>
</tr>
<tr>
<td><code id="compile_:_envir">envir</code></td>
<td>
<p>environment to evaluate loaded expressions in.</p>
</td>
</tr>
<tr>
<td><code id="compile_:_chdir">chdir</code></td>
<td>
<p>logical; change directory before evaluation?</p>
</td>
</tr>
<tr>
<td><code id="compile_:_code">code</code></td>
<td>
<p>byte code expression or compiled closure</p>
</td>
</tr>
<tr>
<td><code id="compile_:_e">e</code></td>
<td>
<p>expression to compile.</p>
</td>
</tr>
<tr>
<td><code id="compile_:_level">level</code></td>
<td>
<p>integer; the JIT level to use (<code>0</code> to <code>3</code>, or
negative to <em>return</em> it).</p>
</td>
</tr>
<tr>
<td><code id="compile_:_enable">enable</code></td>
<td>
<p>logical; enable compiling packages if <code>TRUE</code>.</p>
</td>
</tr>
<tr>
<td><code id="compile_:_name">name</code></td>
<td>
<p>character string; name of option to return.</p>
</td>
</tr>
<tr>
<td><code id="compile_:_...">...</code></td>
<td>
<p>named compiler options to set.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The function <code>cmpfun</code> compiles the body of a closure and
returns a new closure with the same formals and the body replaced by
the compiled body expression.
</p>
<p><code>compile</code> compiles an expression into a byte code object; the
object can then be evaluated with <code>eval</code>.
</p>
<p><code>cmpfile</code> parses the expressions in <code>infile</code>, compiles
them, and writes the compiled expressions to <code>outfile</code>.  If
<code>outfile</code> is not provided, it is formed from <code>infile</code> by
replacing or appending a <code>.Rc</code> suffix.
</p>
<p><code>loadcmp</code> is used to load compiled files.  It is similar to
<code>sys.source</code>, except that its default loading environment is the
global environment rather than the base environment.
</p>
<p><code>disassemble</code> produces a printed representation of the code
that may be useful to give a hint of what is going on.
</p>
<p><code>enableJIT</code> enables or disables just-in-time (JIT)
compilation. JIT is disabled if the argument is 0.  If <code>level</code> is
1 then larger closures are compiled before their first use.  If
<code>level</code> is 2, then some small closures are also compiled before
their second use.  If <code>level</code> is 3 then in addition
all top level loops are compiled before they are executed.  JIT level
3 requires the compiler option <code>optimize</code> to be 2 or 3.  The JIT
level can also be selected by starting <span class="rlang"><b>R</b></span> with the environment
variable <code>R_ENABLE_JIT</code> set to one of these values. Calling
<code>enableJIT</code> with a negative argument returns the current JIT
level. The default JIT level is <code>3</code>.
</p>
<p><code>compilePKGS</code> enables or disables compiling packages when they
are installed.  This requires that the package uses lazy loading as
compilation occurs as functions are written to the lazy loading data
base. This can also be enabled by starting <span class="rlang"><b>R</b></span> with the environment
variable <code>_R_COMPILE_PKGS_</code> set to a positive integer value.
This should not be enabled outside package installation, because it
causes any serialized function to be compiled, which comes with
time and space overhead. <code>R_COMPILE_PKGS</code> can be used, instead,
to instruct <code>INSTALL</code> to enable/disable compilation of packages
during installation.
</p>
<p>Currently the compiler warns about a variety of things.  It does
this by using <code>cat</code> to print messages.  Eventually this should
use the condition handling mechanism.
</p>
<p>The <code>options</code> argument can be used to control compiler operation. 
There are currently four options: <code>optimize</code>, <code>suppressAll</code>,
<code>suppressUndefined</code>, and <code>suppressNoSuperAssignVar</code>. 
<code>optimize</code> specifies the optimization level, an integer from <code>0</code>
to <code>3</code> (the current out-of-the-box default is <code>2</code>). 
<code>suppressAll</code> should be a scalar logical; if <code>TRUE</code> no messages
will be shown (this is the default). <code>suppressUndefined</code> can be
<code>TRUE</code> to suppress all messages about undefined variables, or it can
be a character vector of the names of variables for which messages should
not be shown.  <code>suppressNoSuperAssignVar</code> can be <code>TRUE</code> to
suppress messages about super assignments to a variable for which no
binding is visible at compile time.  During compilation of packages,
<code>suppressAll</code> is currently <code>FALSE</code>, <code>suppressUndefined</code> is
<code>TRUE</code> and <code>suppressNoSuperAssignVar</code> is <code>TRUE</code>.
</p>
<p><code>getCompilerOption</code> returns the value of the specified option.
The default value is returned unless a value is supplied in the
<code>options</code> argument; the <code>options</code> argument is primarily for
internal use.  <code>setCompilerOption</code> sets the default option
values. Options to set are identified by argument names, e.g.
<code>setCompilerOptions(suppressAll = TRUE, optimize = 3)</code>.
It returns a named list of the previous values.
</p>
<p>Calling the compiler a byte code compiler is actually a bit of a
misnomer: the external representation of code objects currently uses
<code>int</code> operands, and when compiled with <code>gcc</code> the internal
representation is actually threaded code rather than byte code.
</p>


<h3>Author(s)</h3>

<p>Luke Tierney</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">oldJIT <span class="token operator">&lt;-</span> enableJIT<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token comment"># a simple example</span>
f <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> x<span class="token operator">+</span><span class="token number">1</span>
fc <span class="token operator">&lt;-</span> cmpfun<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
fc<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
disassemble<span class="token punctuation">(</span>fc<span class="token punctuation">)</span>

<span class="token comment"># old R version of lapply</span>
la1 <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> FUN<span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    FUN <span class="token operator">&lt;-</span> match.fun<span class="token punctuation">(</span>FUN<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>is.list<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">)</span>
	X <span class="token operator">&lt;-</span> as.list<span class="token punctuation">(</span>X<span class="token punctuation">)</span>
    rval <span class="token operator">&lt;-</span> vector<span class="token punctuation">(</span><span class="token string">"list"</span><span class="token punctuation">,</span> length<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token keyword">in</span> seq_along<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">)</span>
	rval<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;-</span> list<span class="token punctuation">(</span>FUN<span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    names<span class="token punctuation">(</span>rval<span class="token punctuation">)</span> <span class="token operator">&lt;-</span> names<span class="token punctuation">(</span>X<span class="token punctuation">)</span>		  <span class="token comment"># keep `names' !</span>
    return<span class="token punctuation">(</span>rval<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment"># a small variation</span>
la2 <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> FUN<span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    FUN <span class="token operator">&lt;-</span> match.fun<span class="token punctuation">(</span>FUN<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>is.list<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">)</span>
	X <span class="token operator">&lt;-</span> as.list<span class="token punctuation">(</span>X<span class="token punctuation">)</span>
    rval <span class="token operator">&lt;-</span> vector<span class="token punctuation">(</span><span class="token string">"list"</span><span class="token punctuation">,</span> length<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token keyword">in</span> seq_along<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        v <span class="token operator">&lt;-</span> FUN<span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>is.null<span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span> rval<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;-</span> list<span class="token punctuation">(</span>v<span class="token punctuation">)</span>
        <span class="token keyword">else</span> rval<span class="token punctuation">[</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> v
    <span class="token punctuation">}</span>
    names<span class="token punctuation">(</span>rval<span class="token punctuation">)</span> <span class="token operator">&lt;-</span> names<span class="token punctuation">(</span>X<span class="token punctuation">)</span>		  <span class="token comment"># keep `names' !</span>
    return<span class="token punctuation">(</span>rval<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment"># Compiled versions</span>
la1c <span class="token operator">&lt;-</span> cmpfun<span class="token punctuation">(</span>la1<span class="token punctuation">)</span>
la2c <span class="token operator">&lt;-</span> cmpfun<span class="token punctuation">(</span>la2<span class="token punctuation">)</span>
<span class="token comment"># some timings</span>
x <span class="token operator">&lt;-</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span>
y <span class="token operator">&lt;-</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">100</span>

system.time<span class="token punctuation">(</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10000</span><span class="token punctuation">)</span> lapply<span class="token punctuation">(</span>x<span class="token punctuation">,</span> is.null<span class="token punctuation">)</span><span class="token punctuation">)</span>
system.time<span class="token punctuation">(</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10000</span><span class="token punctuation">)</span> la1<span class="token punctuation">(</span>x<span class="token punctuation">,</span> is.null<span class="token punctuation">)</span><span class="token punctuation">)</span>
system.time<span class="token punctuation">(</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10000</span><span class="token punctuation">)</span> la1c<span class="token punctuation">(</span>x<span class="token punctuation">,</span> is.null<span class="token punctuation">)</span><span class="token punctuation">)</span>
system.time<span class="token punctuation">(</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10000</span><span class="token punctuation">)</span> la2<span class="token punctuation">(</span>x<span class="token punctuation">,</span> is.null<span class="token punctuation">)</span><span class="token punctuation">)</span>
system.time<span class="token punctuation">(</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10000</span><span class="token punctuation">)</span> la2c<span class="token punctuation">(</span>x<span class="token punctuation">,</span> is.null<span class="token punctuation">)</span><span class="token punctuation">)</span>
system.time<span class="token punctuation">(</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">1000</span><span class="token punctuation">)</span> lapply<span class="token punctuation">(</span>y<span class="token punctuation">,</span> is.null<span class="token punctuation">)</span><span class="token punctuation">)</span>
system.time<span class="token punctuation">(</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">1000</span><span class="token punctuation">)</span> la1<span class="token punctuation">(</span>y<span class="token punctuation">,</span> is.null<span class="token punctuation">)</span><span class="token punctuation">)</span>
system.time<span class="token punctuation">(</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">1000</span><span class="token punctuation">)</span> la1c<span class="token punctuation">(</span>y<span class="token punctuation">,</span> is.null<span class="token punctuation">)</span><span class="token punctuation">)</span>
system.time<span class="token punctuation">(</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">1000</span><span class="token punctuation">)</span> la2<span class="token punctuation">(</span>y<span class="token punctuation">,</span> is.null<span class="token punctuation">)</span><span class="token punctuation">)</span>
system.time<span class="token punctuation">(</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">1000</span><span class="token punctuation">)</span> la2c<span class="token punctuation">(</span>y<span class="token punctuation">,</span> is.null<span class="token punctuation">)</span><span class="token punctuation">)</span>


enableJIT<span class="token punctuation">(</span>oldJIT<span class="token punctuation">)</span></code></pre>

<hr>
</div></div>
    <footer><p>Rendered with postdoc 1.2.2</p></footer>
  </body>
</html>
